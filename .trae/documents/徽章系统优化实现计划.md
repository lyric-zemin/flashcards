# 徽章系统优化实现计划

## 问题分析
- 当前徽章模型缺少类别字段，无法区分学习徽章和签到徽章
- 徽章达成条件过于简单，仅使用字符串字段
- 用户学习和签到时不会自动获得徽章

## 解决方案

### 1. 调整徽章模型
- **修改 `schema.prisma`**：在 `Badge` 模型中添加 `category` 字段（如 learning, sign_in）和 `requiredValue` 字段（存储达成条件的数值）

### 2. 修改数据库结构
- 运行 `pnpm prisma migrate dev` 更新数据库结构

### 3. 实现徽章检查函数
- **更新 `achievementController.ts`**：
  - 更新 `checkAndGrantLearningBadges` 函数，使用新的模型结构
  - 添加 `checkAndGrantSignInBadges` 函数，基于连续签到天数授予徽章

### 4. 集成到现有功能
- **修改 `userController.ts`**：在 `updateLearningProgress` 中调用学习徽章检查
- **修改 `pointController.ts`**：在 `userSignIn` 中调用签到徽章检查

## 具体修改步骤

### 步骤 1：修改 `schema.prisma`
- 更新 `Badge` 模型，添加 `category` 和 `requiredValue` 字段

### 步骤 2：运行数据库迁移
- 执行 `pnpm prisma migrate dev` 更新数据库结构

### 步骤 3：修改 `achievementController.ts`
- 更新 `checkAndGrantLearningBadges` 函数，使用新的模型结构
- 添加 `checkAndGrantSignInBadges` 函数

### 步骤 4：修改 `userController.ts`
- 在 `updateLearningProgress` 中添加徽章检查逻辑

### 步骤 5：修改 `pointController.ts`
- 在 `userSignIn` 中添加徽章检查逻辑

## 徽章类别和条件设计
- **学习徽章**：
  - 初学者：学习 10 个汉字
  - 学习者：学习 50 个汉字
  - 汉字达人：学习 100 个汉字

- **签到徽章**：
  - 坚持者：连续签到 3 天
  - 连续签到王：连续签到 7 天
  - 签到大师：连续签到 30 天