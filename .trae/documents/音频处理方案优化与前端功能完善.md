# 音频处理方案优化与前端功能完善计划

## 1. 后端音频处理优化

### 1.1 TTS工具函数优化
- **添加token缓存机制**：实现百度语音API的access_token缓存，设置过期时间（默认2592000秒，即30天）
- **自动更新token**：当token过期时，自动重新获取并更新缓存
- **音频文件保存**：将生成的音频数据保存到public目录，使用汉字作为文件名
- **返回资源地址**：生成并返回对应的静态资源URL

### 1.2 处理已有的Flashcard
- **批量生成音频URL**：为数据库中已有的所有flashcard生成音频URL
- **更新数据库**：将生成的音频URL更新到对应的flashcard记录中

## 2. 前端配置与功能完善

### 2.1 Vite代理配置
- **添加代理规则**：在vite.config.ts中添加代理配置，将音频请求代理到后端服务
- **配置路径映射**：确保音频文件能够正确访问

### 2.2 卡片详情页功能完善
- **实现音频播放**：完善handlePlayAudio函数，使用HTML5 Audio元素播放音频
- **播放状态管理**：添加音频播放状态的管理，显示播放动画
- **错误处理**：添加音频加载失败的错误处理

## 3. 实现步骤

1. **修改后端TTS工具**：更新tts.ts文件，添加token缓存和音频文件保存功能
2. **创建音频存储目录**：确保public/audio目录存在
3. **编写批量处理脚本**：为已有的flashcard生成音频URL
4. **配置前端代理**：更新vite.config.ts，添加代理配置
5. **完善前端播放功能**：更新FlashcardDetailPage.tsx，实现音频播放功能
6. **测试验证**：确保所有功能正常工作

## 4. 技术要点

- **Token缓存**：使用内存缓存存储token和过期时间
- **文件操作**：使用Node.js的fs模块保存音频文件
- **路径处理**：确保音频文件的存储路径和访问路径正确
- **前端代理**：使用Vite的server.proxy配置实现代理
- **音频播放**：使用HTML5 Audio API实现音频播放

## 5. 预期效果

- 减少百度API的token获取请求，提高性能
- 音频文件持久化存储，避免重复生成
- 前端能够直接访问音频文件，实现流畅的播放体验
- 已有的flashcard自动生成音频URL，无需手动处理