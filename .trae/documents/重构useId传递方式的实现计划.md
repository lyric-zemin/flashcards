# 重构useId传递方式的实现计划

## 目标
将前端通过URL参数传递userId的方式改为通过axios拦截器在请求头中添加，后端通过中间件统一获取。修改完成后进行构建，处理构建错误。

## 实现步骤

### 前端修改
1. **修改前端api.ts文件**
   - 在axios请求拦截器中，自动从localStorage获取用户ID
   - 将用户ID添加到请求头中，使用`X-User-Id`作为头部名称
   - 修改现有的API调用函数，移除通过URL参数传递userId的逻辑

### 后端修改
1. **创建用户ID中间件**
   - 在后端创建一个新的中间件文件`src/middleware/userIdMiddleware.ts`
   - 中间件从请求头中获取`X-User-Id`
   - 将获取到的用户ID添加到请求对象中，以便后续控制器使用
   - 处理用户ID不存在的情况

2. **修改后端index.ts文件**
   - 导入并使用新创建的用户ID中间件
   - 将中间件应用到所有API路由

3. **修改后端控制器**
   - 修改`flashcardController.ts`，从请求对象中获取用户ID，而不是从URL参数中获取
   - 修改其他需要用户ID的控制器，采用相同的方式获取用户ID

### 构建和错误处理
1. **前端构建**
   - 运行`pnpm build`命令构建前端项目
   - 处理构建过程中出现的错误

2. **后端构建**
   - 运行`pnpm build`命令构建后端项目
   - 处理构建过程中出现的错误

## 技术细节

### 前端
- 使用现有的`getUserId()`函数获取用户ID
- 在请求拦截器中添加条件判断，只有当用户ID存在时才添加请求头
- 保持API调用的向后兼容性，确保修改后不会影响现有功能

### 后端
- 中间件需要处理用户ID不存在的情况，确保API可以正常处理未登录用户的请求
- 在请求对象上添加用户ID属性，类型为`number | undefined`
- 修改控制器中的类型定义，以适应新的用户ID获取方式

## 测试计划
- 测试已登录用户的API调用，确保用户ID正确传递和处理
- 测试未登录用户的API调用，确保API可以正常处理没有用户ID的请求
- 测试不同类型的API调用，确保所有API都能正确处理用户ID